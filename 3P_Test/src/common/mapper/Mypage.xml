<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">

<!-- MyInfo 페이지에 나타낼 나의 정보 값 얻어오기 -->
<select id="getMyInfo" parameterType="String" resultType="memVO">
	SELECT *
	FROM 3p.MEMBER
	WHERE mem_id = #{value}
</select>

<!-- 3PointCharge 페이지에 나타낼 나의 3Point 값 얻어오기 -->
<select id="get3Point" parameterType="String" resultType="int">
	SELECT mem_point
	FROM 3p.MEMBER
	WHERE mem_id = #{value}
</select>

<!-- 추가할 3Point 를 update 하기 -->
<select id="add3Point" parameterType="HashMap">
	UPDATE 3p.MEMBER
	SET mem_point= mem_point + #{addPoint}
	WHERE mem_id = #{memId}
</select>

<!-- myPurchase 페이지에 나타낼 회원 별 구매목록 값 얻어오기 -->
<select id="getMyPurchase" parameterType="String" resultType="purchVO">
	SELECT ol.order_sq as order_sq, ol.order_num as order_num, ol.mem_id as mem_id, ol.per_sq as per_sq, ol.order_cnt as order_cnt, ol.order_price as order_price, per.per_name as per_name
	FROM 3p.PERFUME as per, 3p.ORDERLIST as ol
	WHERE per.per_sq = ol.per_sq AND ol.mem_id = #{value}
	ORDER BY ol.order_num
</select>

<!-- 총 구매횟수 값 얻어오기 -->
<select id="getTotalPurchase" parameterType="String" resultType="int">
	SELECT count(*)
	FROM ( SELECT distinct order_num FROM 3p.ORDERLIST WHERE mem_id = 'user') as imsi
	ORDER BY order_num
</select>

<!-- 구매목록에서 선택 된 향수가 가장 많은 값 얻어오는 메소드 -->
<select id="getMaxPurchase" parameterType="String" resultType="int">
	SELECT max(ct)
	FROM (	SELECT count(*) as ct
			FROM ( SELECT order_num FROM 3p.ORDERLIST WHERE mem_id = 'user') as imsi
			GROUP BY order_num ) as imsi
</select>

</mapper>